<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow rounded p-6">
    <h1 class="text-2xl font-bold mb-4">üë§ User Dashboard</h1>
    <div id="userInfo" class="mb-4">Loading...</div>
    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded">Logout</button>
  </div>

  <script>
    const API = "https://novel-api-r1zv.onrender.com/api/auth";
    const token = localStorage.getItem("token");

    if (!token) window.location = "login.html";

    async function loadDashboard() {
      try {
        const res = await fetch(`${API}/dashboard`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();

        if (res.ok) {
          document.getElementById("userInfo").innerHTML = `
            <p><b>Username:</b> ${data.username}</p>
            <p><b>Email:</b> ${data.email}</p>
            <p><b>Role:</b> ${data.role}</p>
            <p><b>Coins:</b> ${data.coins}</p>
          `;
        } else {
          document.getElementById("userInfo").innerText = data.error || "Error loading dashboard";
          if (res.status === 401) setTimeout(() => window.location = "login.html", 1000);
        }
      } catch (err) {
        document.getElementById("userInfo").innerText = "‚ö†Ô∏è Network error: " + err.message;
      }
    }

    function logout() {
      localStorage.removeItem("token");
      window.location = "login.html";
    }

    loadDashboard();
  </script>
</body>
</html>
