<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Episode</title>
  <style>
    body { font-family: Arial; margin:20px; }
    button { background:#007BFF; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; }
  </style>
</head>
<body>
  <h1 id="title"></h1>
  <div id="content"></div>
  <button id="unlockBtn" style="display:none;">Unlock Episode</button>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const token = localStorage.getItem("token");

    async function loadEpisode(){
      const res = await fetch("http://localhost:5000/api/episodes/"+id, {
        headers:{ "Authorization":`Bearer ${token}` }
      });
      const ep = await res.json();
      document.getElementById("title").innerText=ep.title;
      if(ep.isFree){ document.getElementById("content").innerText=ep.content; }
      else {
        document.getElementById("content").innerText="This episode is locked.";
        document.getElementById("unlockBtn").style.display="block";
        document.getElementById("unlockBtn").onclick=()=>unlockEpisode(id);
      }
    }

    async function unlockEpisode(epId){
      const res = await fetch(`https://novel-api-r1zv.onrender.com/api/episodes/${epId}/unlock`, {
        method:"POST",
        headers:{ "Authorization":`Bearer ${token}` }
      });
      const data = await res.json();
      if(data.success){
        document.getElementById("content").innerText=data.episode.content;
        document.getElementById("unlockBtn").style.display="none";
      } else {
        alert(data.error);
      }
    }

    loadEpisode();
  </script>
</body>
</html>